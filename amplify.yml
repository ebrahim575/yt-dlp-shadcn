version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Making yt-dlp executable..."
        - chmod +x ./bin/yt-dlp
        - echo "Installing dependencies..."
        - npm ci --cache .npm --prefer-offline
    build:
      commands:
        - echo "Running Next.js build..."
        - npm run build
        - echo "Copying yt-dlp into .next/bin for Lambda runtime..."
        - mkdir -p .next/bin
        - cp ./bin/yt-dlp .next/bin/yt-dlp
        - echo "yt-dlp copied to .next/bin"
        - ls -la .next/bin
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - .next/cache/**/*
      - .npm/**/*